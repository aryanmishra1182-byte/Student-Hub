<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Timetable | Student Hub</title>
  <style>
    body {
      margin:0; font-family:'Segoe UI',sans-serif;
      display:flex; height:100vh;
      background:#f4f4f9; color:#333;
    }
    /* Calendar Section */
    .calendar {
      width:40%; padding:2rem;
      border-right:2px solid #ddd;
      background:#fff; overflow-y:auto;
    }
    .calendar h2 { margin-bottom:1rem; }
    .calendar-controls { display:flex; justify-content:space-between; margin-bottom:1rem; }
    .calendar table { width:100%; border-collapse:collapse; }
    .calendar th, .calendar td {
      width:14.2%; text-align:center;
      padding:1rem; border:1px solid #ccc;
      cursor:pointer; transition:background 0.3s;
    }
    .calendar td:hover { background:#4a90e2; color:white; }
    .calendar .selected { background:#6a11cb; color:white; }

    /* Timetable Section */
    .timetable {
      flex:1; padding:2rem;
      background:#fafafa; display:flex; flex-direction:column;
    }
    .timetable h2 { margin-bottom:1rem; }
    .search-bar { margin-bottom:1rem; }
    .search-bar input {
      width:100%; padding:0.5rem;
      border:1px solid #ccc; border-radius:8px;
    }
    .tasks {
      flex:1; overflow-y:auto;
      border:1px solid #ccc; border-radius:8px;
      padding:1rem; background:white;
    }
    .task {
      display:flex; align-items:center;
      margin-bottom:0.5rem; gap:0.5rem;
      padding:0.5rem; border-radius:6px;
      transition:background 0.3s;
    }
    .task:hover { background:#f0f0f0; }
    .task input[type="time"], .task input[type="text"], .task select {
      border:1px solid #ccc; border-radius:4px;
      padding:0.3rem; font-size:0.9rem;
    }
    .task input[type="text"] { flex:1; }
    .task button {
      border:none; background:#e74c3c; color:white;
      border-radius:4px; padding:0.3rem 0.6rem;
      cursor:pointer;
    }
    .task button:hover { opacity:0.8; }
    .task .category-study { border-left:4px solid #4a90e2; }
    .task .category-personal { border-left:4px solid #27ae60; }
    .task .category-other { border-left:4px solid #f39c12; }
    .add-btn {
      margin-top:1rem; padding:0.6rem;
      border:none; border-radius:8px;
      background:linear-gradient(135deg,#4a90e2,#6a11cb);
      color:white; font-weight:bold; cursor:pointer;
    }
    .add-btn:hover { opacity:0.9; }
  </style>
</head>
<body>
  <!-- Calendar -->
  <div class="calendar">
    <h2>ðŸ“… Select a Date</h2>
    <div class="calendar-controls">
      <button id="prevMonth">â—€</button>
      <span id="monthLabel"></span>
      <button id="nextMonth">â–¶</button>
    </div>
    <table id="calendarTable"></table>
  </div>

  <!-- Timetable -->
  <div class="timetable">
    <h2 id="selectedDate">Select a date</h2>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="ðŸ” Search tasks...">
    </div>
    <div class="tasks" id="tasksContainer">
      <p>No tasks scheduled yet.</p>
    </div>
    <button class="add-btn" id="addTaskBtn">âž• Add Task</button>
  </div>

  <script>
    const calendarTable=document.getElementById("calendarTable");
    const tasksContainer=document.getElementById("tasksContainer");
    const selectedDateHeading=document.getElementById("selectedDate");
    const addTaskBtn=document.getElementById("addTaskBtn");
    const searchInput=document.getElementById("searchInput");
    const monthLabel=document.getElementById("monthLabel");

    let today=new Date();
    let currentMonth=today.getMonth();
    let currentYear=today.getFullYear();
    let tasksByDate=JSON.parse(localStorage.getItem("tasksByDate"))||{};
    let currentDate=null;

    function renderCalendar(){
      const firstDay=new Date(currentYear,currentMonth,1).getDay();
      const daysInMonth=new Date(currentYear,currentMonth+1,0).getDate();
      monthLabel.textContent=new Date(currentYear,currentMonth).toLocaleString('default',{month:'long',year:'numeric'});
      let html="<tr>"+["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(d=>`<th>${d}</th>`).join("")+"</tr><tr>";
      for(let i=0;i<firstDay;i++) html+="<td></td>";
      for(let d=1;d<=daysInMonth;d++){
        if((d+firstDay-1)%7===0) html+="</tr><tr>";
        html+=`<td data-day="${d}">${d}</td>`;
      }
      html+="</tr>";
      calendarTable.innerHTML=html;
    }
    renderCalendar();

    document.getElementById("prevMonth").onclick=()=>{currentMonth--; if(currentMonth<0){currentMonth=11; currentYear--;} renderCalendar();};
    document.getElementById("nextMonth").onclick=()=>{currentMonth++; if(currentMonth>11){currentMonth=0; currentYear++;} renderCalendar();};

    calendarTable.addEventListener("click",e=>{
      if(e.target.dataset.day){
        document.querySelectorAll(".calendar td").forEach(td=>td.classList.remove("selected"));
        e.target.classList.add("selected");
        currentDate=`${e.target.dataset.day}/${currentMonth+1}/${currentYear}`;
        selectedDateHeading.textContent=`ðŸ“… Timetable for ${currentDate}`;
        renderTasks(currentDate);
      }
    });

    function renderTasks(dateStr){
      tasksContainer.innerHTML="";
      let filtered=(tasksByDate[dateStr]||[]).filter(task=>task.text.toLowerCase().includes(searchInput.value.toLowerCase()));
      if(filtered.length===0){ tasksContainer.innerHTML="<p>No tasks scheduled yet.</p>"; return; }
      filtered.forEach((task,i)=>{
        const div=document.createElement("div");
        div.className="task category-"+task.category;
        const check=document.createElement("input"); check.type="checkbox"; check.checked=task.done||false;
        check.onchange=()=>{tasksByDate[dateStr][i].done=check.checked; saveLocal();};
        const time=document.createElement("input"); time.type="time"; time.value=task.time;
        time.oninput=()=>{tasksByDate[dateStr][i].time=time.value; saveLocal();};
        const text=document.createElement("input"); text.type="text"; text.value=task.text;
        text.oninput=()=>{tasksByDate[dateStr][i].text=text.value; saveLocal();};
        const category=document.createElement("select");
        ["study","personal","other"].forEach(c=>{
          const opt=document.createElement("option"); opt.value=c; opt.textContent=c; if(task.category===c) opt.selected=true; category.appendChild(opt);
        });
        category.onchange=()=>{tasksByDate[dateStr][i].category=category.value; saveLocal();};
        const del=document.createElement("button"); del.textContent="âŒ";
        del.onclick=()=>{tasksByDate[dateStr].splice(i,1); saveLocal(); renderTasks(dateStr);};
        div.append(check,time,text,category,del);
        tasksContainer.appendChild(div);
      });
    }

    function saveLocal(){ localStorage.setItem("tasksByDate",JSON.stringify(tasksByDate)); }

    addTaskBtn.onclick=()=>{
      if(!currentDate){ alert("Please select a date first."); return; }
      if(!tasksByDate[currentDate]) tasksByDate[currentDate]=[];
      tasksByDate[currentDate].push({time:"09:00",text:"New Task",category:"study",done:false});
      saveLocal(); renderTasks(currentDate);
      
    };

    searchInput.oninput=()=>{ if(currentDate) renderTasks(currentDate); };
    
  </script>
  
</body>
</<!-- Extra modal fields -->
<select id="taskRepeat">
  <option value="none">No Repeat</option>
  <option value="daily">Daily</option>
  <option value="weekly">Weekly</option>
</select>
<div class="autosave" id="timetableSave">Not saved</div>

<script>
  // Extend saveTask logic
  const saveTaskBtn=document.getElementById('saveTask');
  saveTaskBtn.addEventListener('click',()=>{
    const date=document.getElementById('taskDate').value;
    const time=document.getElementById('taskTime').value;
    const text=document.getElementById('taskText').value.trim();
    const category=document.getElementById('taskCategory').value;
    const repeat=document.getElementById('taskRepeat').value;
    if(!date||!time||!text) return;
    const d=new Date(date);
    const dateStr=`${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()}`;
    const tasksByDate=JSON.parse(localStorage.getItem('tasksByDate'))||{};
    if(!tasksByDate[dateStr]) tasksByDate[dateStr]=[];
    tasksByDate[dateStr].push({time,text,category,repeat,done:false});
    localStorage.setItem('tasksByDate',JSON.stringify(tasksByDate));
    document.getElementById('timetableSave').textContent='Saved âœ”';
  });

  // Dragâ€‘drop support
  const tasksContainer=document.getElementById('tasksContainer');
  tasksContainer.addEventListener('dragstart',e=>{
    if(e.target.classList.contains('task')) e.dataTransfer.setData('text/plain',e.target.dataset.index);
  });
  tasksContainer.addEventListener('drop',e=>{
    e.preventDefault();
    const from=e.dataTransfer.getData('text/plain');
    const to=e.target.closest('.task').dataset.index;
    // reorder logic hereâ€¦
  });
  tasksContainer.addEventListener('dragover',e=>e.preventDefault());
</script>
