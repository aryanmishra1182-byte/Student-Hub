<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Notebook Keeper</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
    --grad: linear-gradient(135deg,#6a11cb,#2575fc);
    --shadow: 0 4px 14px rgba(0,0,0,0.15);
    --radius: 14px;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI";}

body{display:flex;height:100vh;background:#f7f7ff;overflow:hidden;}

.sidebar{
    width:250px;background:white;padding:20px;box-shadow:var(--shadow);
    display:flex;flex-direction:column;
}

.notebook-list{flex:1;overflow:auto;margin-top:10px;}

.notebook-item{
    padding:10px;border-radius:10px;background:#ece6ff;margin-bottom:10px;
    position:relative;cursor:pointer;
}
.notebook-item:hover{background:#d7c2ff;}

.bin-btn{
    position:absolute;right:8px;top:8px;background:#ff4d4d;
    border:none;color:white;border-radius:6px;padding:2px 7px;cursor:pointer;
}

.share-btn{
    position:absolute;right:42px;top:8px;
    background:#ffffffaa;border:none;border-radius:6px;
    padding:2px 7px;cursor:pointer;
}

.add-box input{
    width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;margin-bottom:10px;
}
.btn{
    background:var(--grad);color:white;padding:10px;border:none;width:100%;
    border-radius:10px;cursor:pointer;
}

/* Main area */
.main{flex:1;padding:25px;overflow:auto;}
.toolbar button{
    padding:8px 12px;background:#e5dfff;border:none;border-radius:8px;margin-right:10px;cursor:pointer;
}

#textBox{
    width:100%;height:45%;padding:15px;background:white;border-radius:var(--radius);
    box-shadow:var(--shadow);overflow:auto;margin-top:10px;
}

canvas{
    margin-top:15px;background:white;border-radius:var(--radius);box-shadow:var(--shadow);
}

/* Gemini */
.gemini{
    width:300px;background:white;padding:20px;box-shadow:var(--shadow);
    display:flex;flex-direction:column;
}
.chat-box{flex:1;background:#f1f1f1;padding:10px;border-radius:10px;overflow:auto;}
.chat-input{display:flex;margin-top:10px;gap:8px;}
.chat-input input{flex:1;padding:8px;border-radius:8px;border:1px solid #ccc;}
.chat-input button{padding:8px 14px;background:var(--grad);border:none;color:white;border-radius:8px;}

/* Share Popup */
.share-popup{
    position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
    background:white;padding:15px;border-radius:10px;box-shadow:var(--shadow);
    display:none;
}
.share-popup button{
    margin:5px 0;padding:8px 12px;width:100%;border:none;border-radius:8px;cursor:pointer;
}
</style>
</head>

<body>

<!-- Sidebar -->
<div class="sidebar">
    <h3>üìö Notebooks</h3>
    <div class="notebook-list" id="list"></div>

    <div class="add-box">
        <input id="newName" placeholder="New Notebook">
        <button class="btn" onclick="addNotebook()">Create</button>
    </div>
</div>

<!-- Main -->
<div class="main">
    <h2 id="title">Select a Notebook</h2>

    <!-- Toolbar -->
    <div class="toolbar">
        <button onclick="fmt('bold')">B</button>
        <button onclick="fmt('italic')">I</button>
        <button onclick="fmt('underline')">U</button>
        <button onclick="toggleDraw()">‚úè Draw</button>
        <button onclick="useEraser()">ü©π Eraser</button>
        <button onclick="clearCanvas()">üóë Clear</button>
        <button onclick="undo()">‚Ü∂ Undo</button>

        <!-- Brush Tools -->
        <input type="color" id="brushColor" value="#000000" style="width:40px;height:35px;border:none;">
        <input type="range" id="brushSize" min="2" max="20" value="3" style="width:100px;">
        
        <button onclick="saveNote()">üíæ Save</button>
    </div>

    <div id="textBox" contenteditable="true"></div>
    <canvas id="pad" width="900" height="250"></canvas>
</div>

<!-- Gemini -->
<div class="gemini">
    <h3>ü§ñ Gemini</h3>
    <div class="chat-box" id="chat"></div>
    <div class="chat-input">
        <input id="ask" placeholder="Ask Gemini...">
        <button onclick="sendGemini()">Send</button>
    </div>
</div>

<!-- Share popup -->
<div class="share-popup" id="sharePopup">
    <div id="shareLink" style="font-size:12px;margin-bottom:10px;"></div>
    <button onclick="copyLink()">Copy Link</button>
    <button onclick="shareWhatsApp()">WhatsApp</button>
    <button onclick="closeShare()">Close</button>
</div>

<script>
let books = JSON.parse(localStorage.getItem("books")) || {};
let current = "";
let list = document.getElementById("list");

function loadBooks(){
    list.innerHTML="";
    for(let name in books){
        let div=document.createElement("div");
        div.className="notebook-item";
        div.innerHTML = `
            ${name}
            <button class='share-btn' onclick='openShare("${name}");event.stopPropagation();'>Share</button>
            <button class='bin-btn' onclick='delNotebook("${name}");event.stopPropagation();'>üóë</button>
        `;
        div.onclick=()=>openBook(name);
        list.appendChild(div);
    }
}

function addNotebook(){
    let name=document.getElementById("newName").value.trim();
    if(!name){alert("Enter a name");return;}
    books[name]={text:"",drawing:""};
    saveBooks(); loadBooks();
}

function delNotebook(name){
    if(confirm("Delete this notebook?")){
        delete books[name];
        saveBooks(); loadBooks();
        current="";
        document.getElementById("title").innerText="Select a Notebook";
        document.getElementById("textBox").innerHTML="";
        clearCanvas(true);
    }
}

function openBook(name){
    current=name;
    document.getElementById("title").innerText=name;
    document.getElementById("textBox").innerHTML=books[name].text;

    loadDrawing(books[name].drawing);
}

function saveBooks(){
    localStorage.setItem("books",JSON.stringify(books));
}

function fmt(cmd){
    document.execCommand(cmd,false,null);
}

/* =============== CANVAS FIXED SYSTEM =============== */
let pad=document.getElementById("pad");
let ctx=pad.getContext("2d");

let drawing=false;
let currentTool="pen"; // "pen" or "eraser"
let undoStack=[];

/* SAVE STATE FOR UNDO */
function pushUndo(){
    undoStack.push(pad.toDataURL());
    if(undoStack.length > 30) undoStack.shift();
}

/* CANVAS EVENTS */
pad.addEventListener("mousedown", function(e){
    drawing=true;
    pushUndo();
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
});

pad.addEventListener("mouseup", function(){
    drawing=false;
    ctx.beginPath();
});

pad.addEventListener("mousemove", function(e){
    if(!drawing) return;

    ctx.lineWidth = document.getElementById("brushSize").value;

    if(currentTool === "pen"){
        ctx.strokeStyle = document.getElementById("brushColor").value;
    }
    else if(currentTool === "eraser"){
        ctx.strokeStyle = "#FFFFFF";
    }

    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
});

/* TOOLS */
function toggleDraw(){
    currentTool="pen";
    ctx.beginPath();
}

function useEraser(){
    currentTool="eraser";
    ctx.beginPath();
}

function clearCanvas(noUndo){
    if(!noUndo) pushUndo();
    ctx.clearRect(0,0,pad.width,pad.height);
}

function undo(){
    if(undoStack.length === 0) return;

    let last = undoStack.pop();
    let img = new Image();

    img.src = last;
    img.onload = function(){
        ctx.clearRect(0,0,pad.width,pad.height);
        ctx.drawImage(img,0,0);
    };
}

/* LOAD DRAWING */
function loadDrawing(data){
    clearCanvas(true);
    if(!data) return;

    let img = new Image();
    img.src = data;

    img.onload = ()=>ctx.drawImage(img,0,0);
}

/* SAVE NOTE */
function saveNote(){
    if(!current){
        alert("Select a notebook");
        return;
    }
    books[current].text = document.getElementById("textBox").innerHTML;
    books[current].drawing = pad.toDataURL();
    saveBooks();
    alert("Saved!");
}

/* Gemini */
function sendGemini(){
    let q=document.getElementById("ask").value.trim();
    if(!q) return;
    let c=document.getElementById("chat");
    c.innerHTML+=`<div>You: ${q}</div>`;
    c.innerHTML+=`<div>Gemini: AI placeholder response.</div>`;
    document.getElementById("ask").value="";
    c.scrollTop=c.scrollHeight;
}

/* Share */
function openShare(name){
    let link=`https://studenthub/notebook?name=${encodeURIComponent(name)}`;
    document.getElementById("shareLink").innerText=link;
    document.getElementById("sharePopup").style.display="block";
}
function closeShare(){
    document.getElementById("sharePopup").style.display="none";
}
function copyLink(){
    navigator.clipboard.writeText(document.getElementById("shareLink").innerText);
    alert("Copied!");
}
function shareWhatsApp(){
    let link=document.getElementById("shareLink").innerText;
    window.open(`https://wa.me/?text=${link}`);
}

loadBooks();
</script>


</body>
</html>
